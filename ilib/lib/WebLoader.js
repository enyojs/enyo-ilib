var Path=require("./Path.js");var ilib=require("./ilib.js");var Loader=require("./Loader.js");var WebLoader=function(e,t,o){this.parent.call(this,e);this._loadFile=navigator.userAgent.indexOf(" .NET")>-1?this._ieLoadFile:this._regularLoadFile;var i,r,n,a;var s=document.getElementsByTagName("script");n=window.location.href.lastIndexOf("/");this.root=window.location.href.substring(0,n);a=this.root.indexOf("://");this.root=Path.normalize(Path.join(this.root.substring(a+3)));for(var d=0;d<s.length;d++){var f=s[d].src;if(f&&(n=f.search(/\/ilib-[a-z\-]*\.js$/))!==-1){a=f.indexOf("://");this.protocol=f.substring(0,a+3);i=Path.join(f.substring(a+3,n-1),"..");break}}this.base=Path.normalize(Path.join(i||this.root,"data"));this.includePath.push(Path.join(this.root,"resources"));this._exists(Path.join(i,"locale"),"localeinfo.json");this._exists("/usr/share/javascript/ilib/locale","localeinfo.json")};WebLoader.prototype=new Loader;WebLoader.prototype.parent=Loader;WebLoader.prototype.constructor=WebLoader;WebLoader.prototype.name="WebLoader";WebLoader.prototype._ieLoadFile=function(e,t,o){var i=new ActiveXObject("MSXML2.XMLHTTP");var r=undefined;i.open("GET",this.protocol+e,!t);if(!t){i.onreadystatechange=function(){if(i.readyState===4){r=i.responseText;if(typeof o==="function"){o(r)}}}}try{i.send();r=i.responseText}catch(n){r=undefined}if(t){if(typeof o==="function"){o(r)}}return r};WebLoader.prototype._regularLoadFile=function(e,t,o){var i=new XMLHttpRequest;var r=undefined;if(e.substring(0,this.protocol.length)!==this.protocol){e=this.protocol+e}i.open("GET",e,!t);i.onload=function(e){r=i.response;if(typeof o==="function"){o(i.status===0||i.status===200?r:undefined)}};i.onerror=function(e){r=undefined;if(typeof o==="function"){o(undefined)}};try{i.send()}catch(n){r=undefined;if(typeof o==="function"){o(undefined)}}return r};module.exports=WebLoader;